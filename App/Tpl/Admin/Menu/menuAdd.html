<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>无标题文档</title>
        <link href="__PUBLIC__/Style/Admin/css/style.css" rel="stylesheet" type="text/css" />
        <link href="__PUBLIC__/Style/Admin/css/select.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="__PUBLIC__/Plugins/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="__PUBLIC__/Style/Admin/js/select-ui.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function (e) {
                $(".select1").uedSelect({
                    width: 345
                });

            });
        </script>
        <link rel="stylesheet" href="__PUBLIC__/Plugins/kindeditor/themes/default/default.css" />
        <script src="__PUBLIC__/Plugins/kindeditor/kindeditor.js"></script>
        <script src="__PUBLIC__/Plugins/kindeditor/lang/zh_CN.js"></script>
    </head>

    <body>

        <div class="place">
            <span>位置：</span>
            <ul class="placeul">
                <li><a href="#">首页</a></li>
                <li><a href="#">表单</a></li>
            </ul>
        </div>

        <div class="formbody">

            <div class="formtitle"><span>添加菜单</span></div>
            <form class="registerform" action="{:U('/Admin/AdminMenu/ajaxPost')}">
            <ul class="forminfo">
                <li><label>所属栏目<b>*</b></label>

                    <div class="vocation">
                        <select class="select1" name="parentId">
                            <option value="0" <if condition="$parentId eq 0">selected</if>>顶级菜单</option>
                            
                            <volist name='menus' id='val'>
                                <option value="{$val.id}" <if condition="$parentId eq $val['id']">selected</if>>{$val.name}</option>
                                <volist name='val.childs' id='child'>
                                <option value="{$child.id}" <if condition="$parentId eq $child['id']">selected</if>>&nbsp;&nbsp;&nbsp;&nbsp;├─ {$child.name}</option>
                                </volist>
                            </volist>
                        </select>
                    </div>
                </li>
                {:input(array('title'=>'菜单名称','inputName'=>'name','isMust'=>'1','tipMsg'=>'标题不能超过30个字符','addHtml'=>'datatype="s1-30" errormsg="标题不能超过30个字符"','value'=>$info['name']))}
                {:input(array('title'=>'模块','inputName'=>'module','tipMsg'=>'英文字符串','value'=>$info['module']))}
                {:input(array('title'=>'控制器','inputName'=>'action','tipMsg'=>'英文字符串','value'=>$info['action']))}
                {:input(array('title'=>'其它参数','inputName'=>'parameter','value'=>$info['parameter']))}
                {:radio(array('title'=>'是否启用','inputName'=>'status','value'=>$info['status']))}
                {:radio(array('title'=>'权限验证','inputName'=>'role','value'=>$info['role']))}
                <li><label>icon图标</label><input name="icon" type="text" class="dfinput" value="{$info.value}" /></li>
                {:input(array('title'=>'排序','inputName'=>'sort','value'=>'1'))}
                {:hideInput(array('inputName'=>'id','value'=>$info['id']))}
                <li><label>icon图标</label><input name="image" type="text" id="url1" class="dfinput"  value="" /> <input name="" type="button" id="image1" class="btn" value="上传图片"/></li>
                <li><label>编辑器</label><textarea name="content" style="width:800px;height:400px;visibility:hidden;">这里是初始化内容</textarea></li>
                <li><label>&nbsp;</label><input name="" type="submit" class="btn" value="确认保存"/></li>
            </ul>

            </form>
        </div>
    </body>
<script type="text/javascript" src="__PUBLIC__/Plugins/Validform/Validform_v5.3.2_min.js"></script>
<script type="text/javascript">
KindEditor.ready(function(K) {
    editor = K.create('textarea[name="content"]', {
            allowFileManager : true,
            uploadJson : 'index.php?g=Admin&m=Upload&a=uploadFile',
            fileManagerJson : 'index.php?g=Admin&m=Upload&a=fileManager'
    });
    var editor = K.editor({
            allowFileManager : true,
            uploadJson : 'index.php?g=Admin&m=Upload&a=uploadFile',
            fileManagerJson : 'index.php?g=Admin&m=Upload&a=fileManager&type=Sysicon'
    });
    
    K('#image1').click(function() {
            editor.loadPlugin('image', function() {
                    editor.plugin.imageDialog({
                            showLocal : false,
                            imageUrl : K('#url1').val(),
                            clickFn : function(url) {
                                    K('#url1').val(url);
                                    editor.hideDialog();
                            }
                    });
            });
    });

});
$(function(){
	$(".registerform").Validform({
		tiptype:function(msg,o,cssctl){
			if(!o.obj.is("form")){
				var objtip=o.obj.siblings(".Validform_checktip");
				cssctl(objtip,o.type);
				objtip.text(msg);
			}
		},
                datatype:{
                        "*6-20": /^[^\s]{6,20}$/,
                        "z2-4" : /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,4}$/,
                        "y3-10": /\w{3,10}/i,
                },
                ajaxPost:true,
                callback:function(data){
                        if(data.status==1)
                        {
                            alert(data.info);
                            location.href="{:U('Admin/AdminMenu/index')}";
                        }
                        else
                        {
                            alert(data.info);
                        }
		}
	});
})
</script>
</html>

