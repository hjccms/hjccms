<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>无标题文档</title>
        <link href="__PUBLIC__/Style/Admin/css/style.css" rel="stylesheet" type="text/css" />
     
        <script type="text/javascript" src="__PUBLIC__/Plugins/jquery-1.9.1.min.js"></script>
     
        <link rel="stylesheet" href="__PUBLIC__/Plugins/kindeditor/themes/default/default.css" />
        <script src="__PUBLIC__/Plugins/kindeditor/kindeditor.js"></script>
        <script src="__PUBLIC__/Plugins/kindeditor/lang/zh_CN.js"></script>
    </head>

    <body>

        <include file="Index:position"/>

        <div class="formbody">

            <div class="formtitle"><span>添加管理员</span></div>
            <form class="registerform" action="{:U('/Admin/Model/dataAjaxPost/table_name/admin')}">
            <ul class="forminfo">

                {:input(array('title'=>'姓名','inputName'=>'name','isMust'=>'1','tipMsg'=>'不能超过30个字符','addHtml'=>'datatype="s1-30" errormsg="标题不能超过30个字符" ajaxurl="/Admin/Model/checkFieldOnly/table_name/admin" sucmsg="验证通过！"','value'=>$info['name']))}
                {:input(array('title'=>'帐号','inputName'=>'username','isMust'=>'1','tipMsg'=>'帐号请用纯英文填写','addHtml'=>'datatype="y1-20"  ajaxurl="/Admin/Model/checkFieldOnly/table_name/admin"   errormsg="格式为纯英文"','value'=>$info['field_name']))}
                
                {:inputPassword(array('title'=>'设置密码','isMust'=>'1','inputName'=>'password','tipMsg'=>'请设置密码','addHtml'=>'datatype="s"   errormsg="格式为纯英文"','value'=>$info['password']))}
                {:inputPassword(array('title'=>'确认密码','isMust'=>'1','inputName'=>'password2','tipMsg'=>'请确认密码','addHtml'=>'datatype="s" recheck="password"  errormsg="密码不一致"','value'=>$info['password']))}
                {:hideInput(array('inputName'=>'importAction','value'=>'AdminAction'))}
                {:hideInput(array('inputName'=>'importFun','value'=>'ajaxAdminAdd'))}
                {:select(array('title'=>'角色类型','inputName'=>'role_id','isMust'=>'1','addHtml'=>'datatype="*" errormsg="请选择" id="juese" ','value'=>$info['role_id'],'paramArr'=>$roles))}
               
                {:input(array('title'=>'手机号码','inputName'=>'mobile','isMust'=>'1','tipMsg'=>'管理员手机号码','addHtml'=>'datatype="m"     errormsg="格式错误"','value'=>''))}
                {:radio(array('title'=>'是否启用','inputName'=>'valid','value'=>0,'paramArr'=>get_valid()))}
                
               
                 {:input(array('title'=>'Email','inputName'=>'email','tipMsg'=>'','addHtml'=>'datatype="e"   ignore="ignore"   errormsg="格式错误"','value'=>''))}
                {:hideInput(array('inputName'=>'id','value'=>$info['id']))}
                <li><label>&nbsp;</label><input name="" type="submit" class="btn" value="确认保存"/></li>
            </ul>

            </form>
        </div>
    </body>
<script type="text/javascript" src="__PUBLIC__/Plugins/Validform/Validform_v5.3.2.js"></script>
<script type="text/javascript">

$(function(){
	$(".registerform").Validform({
		tiptype:function(msg,o,cssctl){
			if(!o.obj.is("form")){
				var objtip=o.obj.siblings(".Validform_checktip");
				cssctl(objtip,o.type);
				objtip.text(msg);
			}
		},
                datatype:{
                        "*6-20": /^[^\s]{6,20}$/,
                        "z2-4" : /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,4}$/,
                        "y3-10": /\w{3,10}/i,
                        "y1-20": /^[a-zA-Z\/ ]{1,20}$/,
                },
                ajaxPost:true,
                callback:function(data){
                        if(data.status==1)
                        {
                            alert(data.info);
                            location.href="{:U('Admin/Admin/index')}";
                        }
                        else
                        {
                            alert(data.info);
                        }
		}
	});
        $(document).on("change", "#juese", function(e) {
            var role = $(this).val();
            
            $.ajax({
                type: "POST",
                url: "/Admin/Admin/changeRole/",
                data: "role_id="+role,
                dataType: "json",
                
                success: function(msg)
                {
                    if(msg.status==1)
                    {
                        $("#juese").parent().parent().after(msg.info);
                    }
                    if(msg.status==2)
                    {
                        $("#"+msg.info).parent().parent().html('');
                        $("#seladmin").parent().parent().html('');
                    }
                }
             });
            

            
        });
        $(document).on("change", "#selsite", function(e) {
            var site = $(this).val();
            
            $.ajax({
                type: "POST",
                url: "/Admin/Admin/changeSite/",
                data: "site_id="+site,
                dataType: "json",
                
                success: function(msg)
                {
                    if(msg.status==1)
                    {
                        $("#seladmin").parent().parent().html('');
                        $("#selsite").parent().parent().after(msg.info);
                    }
                    
                }
             });
            

            
        });
})
</script>
</html>

